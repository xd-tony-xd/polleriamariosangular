<h2 mat-dialog-title class="text-2xl font-bold text-gray-800 border-b pb-3 mb-4 flex items-center gap-2">
  <mat-icon color="primary">{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
  {{ isEditMode ? 'Editar Plato' : 'Crear Nuevo Plato' }}
</h2>

<form [formGroup]="platoForm" (ngSubmit)="onSubmit()">

  <mat-dialog-content class="flex flex-col gap-6">

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <mat-form-field appearance="outline" class="md:col-span-2">
        <mat-label>Nombre del Plato</mat-label>
        <input matInput formControlName="nombre" placeholder="Ej: Pollo a la brasa">
        <mat-icon matSuffix>restaurant</mat-icon>
        <mat-error *ngIf="platoForm.get('nombre')?.invalid">El nombre es obligatorio</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Precio (S/.)</mat-label>
        <input matInput type="number" min="0.01" formControlName="precio">
        <mat-icon matSuffix>attach_money</mat-icon>
        <mat-error *ngIf="platoForm.get('precio')?.errors?.['required']">Precio requerido</mat-error>
        <mat-error *ngIf="platoForm.get('precio')?.errors?.['min']">Debe ser positivo</mat-error>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline">
      <mat-label>Descripción</mat-label>
      <textarea matInput rows="3" formControlName="descripcion" placeholder="Detalles de la preparación..."></textarea>
      <mat-icon matSuffix>description</mat-icon>
    </mat-form-field>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Categoría</mat-label>
        <mat-select formControlName="idCategoria">
          <mat-option [value]="''" disabled>-- Seleccione una Categoría --</mat-option>
          <mat-option *ngFor="let c of categorias" [value]="c.id">
            {{ c.nombre }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="platoForm.get('idCategoria')?.invalid">Categoría requerida</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Horario</mat-label>
        <mat-select formControlName="idHorario">
          <mat-option [value]="''" disabled>-- Seleccione un Horario --</mat-option>
          <mat-option *ngFor="let h of horarios" [value]="h.id">
            {{ h.turno }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="platoForm.get('idHorario')?.invalid">Horario requerido</mat-error>
      </mat-form-field>
    </div>

    <div class="flex items-center">
      <mat-checkbox formControlName="disponible" color="primary">
        Plato disponible para venta
      </mat-checkbox>
    </div>

    <div class="border p-5 rounded-xl shadow-sm bg-gray-50">
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 text-gray-700">
        <mat-icon>image</mat-icon> Imagen del Plato
      </h3>

      <div *ngIf="currentImageUrl" class="mb-4 relative">
        <img 
          [src]="currentImageUrl"
          alt="Vista previa"
          class="w-full max-h-60 object-contain rounded-lg border shadow-sm bg-white"
        />

        <button 
          mat-icon-button 
          color="warn" 
          (click)="clearImage()" 
          class="absolute top-2 right-2 bg-white rounded-full shadow hover:scale-110 transition"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Subir Imagen (archivo)</mat-label>
        <input matInput type="text" [value]="selectedFile?.name || ''" readonly>

        <input 
          type="file" 
          hidden 
          #fileInputRef 
          (change)="onFileSelected($event)" 
          accept="image/*"
          id="fileInputPlato"
        >

        <button mat-icon-button matSuffix type="button" (click)="fileInputRef.click()">
          <mat-icon>folder_open</mat-icon>
        </button>
      </mat-form-field>

      <div class="text-center my-2 text-gray-500 text-sm">— O ingrese una URL —</div>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>URL de Imagen</mat-label>
        <input 
          matInput 
          formControlName="imagenUrl" 
          placeholder="https://misimagenes.com/imagen.jpg"
          (input)="onUrlInput($event)"
        >
        <mat-icon matSuffix>link</mat-icon>
      </mat-form-field>
    </div>

  </mat-dialog-content>

  <mat-dialog-actions align="end" class="mt-5 border-t pt-4">
    <button mat-button type="button" (click)="onCancel()">Cancelar</button>

    <button 
      mat-raised-button 
      color="primary" 
      type="submit" 
      [disabled]="platoForm.invalid || isSubmitting">
      <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
      {{ isEditMode ? 'Guardar Cambios' : 'Crear Plato' }}
    </button>
  </mat-dialog-actions>

</form>